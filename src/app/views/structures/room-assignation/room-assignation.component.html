<c-row ngPreserveWhitespaces>
  <c-col xs="12">
    <c-card class="mb-3">
      <c-card-header ngPreserveWhitespaces>
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <strong style="text-align: left;">Seguimiento y Control de Asignacion de Salas</strong>
          <button cButton type="submit" class="btn-gray" style="margin-left: 8px;" (click)="downloadPdf()">
            <i class="cil-file"></i> Generar Reporte
          </button>
        </div>
      </c-card-header>
      <c-card-body>
        <c-nav variant="pills">
          <c-nav-item>
            <a [cTabContent]="tabContent3" [routerLink] [tabPaneIdx]="0" cNavLink (click)="getListTutors()">
              <svg cIcon class="me-2" name="cilHome"></svg>
              Busqueda
            </a>
          </c-nav-item>
          <c-nav-item>
            <a [cTabContent]="tabContent3" [routerLink] [tabPaneIdx]="1" cNavLink (click)="getParametersTutors()">
              <svg cIcon class="me-2" name="cilUser"></svg>
              Gestion
            </a>
          </c-nav-item>
          <!--<c-nav-item>
            <a [cTabContent]="tabContent3" [routerLink] [tabPaneIdx]="2" cNavLink>
              <svg cIcon class="me-2" name="cilCode"></svg>
              Contact
            </a>
          </c-nav-item>-->
        </c-nav>
        <c-tab-content #tabContent3="cTabContent" cRounded="bottom" (activeTabPaneIdxChange)="changeTab($event)"
          [activeTabPaneIdx]="tabindex">
          <c-tab-pane aria-labelledby="docs-code-preview" class="p-3 preview" role="tabpanel">
            <strong>{{ typeName }}</strong>
            <small>{{ this.listTypes.length }}</small> registros encontrados
            <p class="text-medium-emphasis small">
              Asignacion de Salas - Colaboradores, si desea crear un nuevo registro,
              presione:
              <code>Gestion</code>
            </p>
            <form cForm class="row g-3" [formGroup]="formSearch">
              <c-col [md]="6" *ngIf="isVisibleCollaborator">
                <label cLabel>Ni√±os </label>
                <app-selector-generic [parameterList]="collaboratorList" [enableAllOptions]="true"
                  (onRowChange)="onSelectedCollaboratorFilter($event)"></app-selector-generic></c-col>
              <c-col [md]="6">
                <label cLabel>Salas</label>
                <app-select-parameters [parameterList]="listRooms" [enableAllOptions]="true"
                  (onRowChange)="onSelectedRoomFilter($event)"></app-select-parameters></c-col>
              <c-col [md]="6" *ngIf="isVisibleTurn">
                <label cLabel>Turnos</label>
                <app-select-parameters [parameterList]="listTurns" [enableAllOptions]="true"
                  (onRowChange)="onSelectedTurnFilter($event)"></app-select-parameters>
              </c-col>
              <c-col [md]="6" *ngIf="isVisibleModality">
                <label cLabel>Modalidad</label>
                <app-select-parameters [parameterList]="listModality" [enableAllOptions]="true"
                  (onRowChange)="onSelectedTurnFilter($event)"></app-select-parameters>
              </c-col>
              <c-col [md]="6" *ngIf="isVisibleBranchOfficeStatus">
                <label cLabel>Sucursal</label>
                <app-select-parameters [parameterList]="listBranchOfficeStatus" [enableAllOptions]="true"
                  (onRowChange)="onSelectedTurnFilter($event)"></app-select-parameters>
              </c-col>
              <c-col [md]="6" *ngIf="isVisibleCityStatus">
                <label cLabel>Ciudad</label>
                <app-select-parameters [parameterList]="listCityStatus" [enableAllOptions]="true"
                  (onRowChange)="onSelectedTurnFilter($event)"></app-select-parameters>
              </c-col>
              <c-col [xs]="12">
                <div class="d-flex justify-content-end">
                  <button cButton type="submit" class="btn-warning" (click)="filterSearch(true)" style="margin: 0 8px">
                    <i class="cil-x-circle"></i> Limpiar
                  </button>
                  <button cButton type="submit" (click)="filterSearch(false)">
                    <i class="cil-magnifying-glass"></i> Buscar
                  </button>
                </div>
              </c-col>
            </form>
            <br />
            <table cTable *ngIf="isVisible" [hover]="true" [responsive]="true" [striped]="false" align="middle">
              <thead cTableColor="info">
                <tr>
                  <th scope="col">Colaborador</th>
                  <th scope="col">Sala</th>
                  <th scope="col">Turno</th>
                  <th scope="col">Modalidad</th>
                  <th scope="col">Sucursal</th>
                  <th scope="col">Ciudad</th>
                  <th scope="col">Observaciones</th>
                  <th scope="col">Creado por</th>
                  <th scope="col">Creado en</th>
                  <th scope="col">Modificado por</th>
                  <th scope="col">Modificado en</th>
                  <th scope="col">Estado</th>
                  <th scope="col">Acciones</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of visibleItems()">
                  <td>
                    {{ row.collaborator }}
                  </td>
                  <td>
                    {{ row.room }}
                  </td>
                  <td>
                    {{ row.turn }}
                  </td>
                  <td>
                    {{ row.modality }}
                  </td>
                  <td>
                    {{ row.branchOffice }}
                  </td>
                  <td>
                    {{ row.city }}
                  </td>
                  <td>
                    {{ row.observations }}
                  </td>
                  <td>{{ row.userCreation }}</td>
                  <td>{{ row.dateCreation | date : "yyyy/MM/dd hh:mm:ss" }}</td>
                  <td>{{ row.userModification }}</td>
                  <td>
                    {{ row.dateModification | date : "yyyy/MM/dd hh:mm:ss" }}
                  </td>
                  <td>
                    <c-badge class="me-1" color="{{ !row.isDeleted ? 'success' : 'danger' }}">{{ !row.isDeleted ?
                      "ACTIVO" : "INACTIVO" }}</c-badge>
                  </td>
                  <td>
                    <button color="warning" cButton class="me-1" shape="rounded-pill" (click)="editRow(row)"
                      disabled="{{ row.isDeleted }}">
                      <svg cIcon class="me-2" name="cil-pencil"></svg>
                    </button>
                  </td>
                  <td>
                    <button color="{{ row.isDeleted ? 'success' : 'danger' }}" cButton class="me-1" shape="rounded-pill"
                      (click)="enableOrDisable(row)">
                      <svg cIcon class="me-2" [name]="row.isDeleted ? 'cil-check' : 'cil-trash'"></svg>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <app-pagination [totalItems]="listTypes.length" [itemsPerPage]="itemsPerPage" [currentPage]="currentPage"
              (pageChanged)="onPageChange($event)"></app-pagination>
          </c-tab-pane>
          <c-tab-pane aria-labelledby="docs-code-preview" class="p-3 preview" role="tabpanel">
            <form cForm class="row g-3" [formGroup]="form">
              <c-col [md]="6" *ngIf="isVisibleCollaborator">
                <label cLabel>Colaborador </label>
                <app-selector-generic [parameterList]="collaboratorList" [selectedValue]="collaboratorSelected"
                  (onRowChange)="onSelectedCollaborator($event)"></app-selector-generic></c-col>
              <c-col [md]="6" *ngIf="isVisibleRoom">
                <label cLabel>Salas</label>
                <app-select-parameters [parameterList]="listRooms" [selectedValue]="selectedRoom"
                  (onRowChange)="onSelectedRoom($event)"></app-select-parameters></c-col>
              <c-col [md]="6" *ngIf="isVisibleTurn">
                <label cLabel>Turnos</label>
                <app-select-parameters [parameterList]="listTurns" [selectedValue]="selectedTurn"
                  (onRowChange)="onSelectedTurn($event)"></app-select-parameters>
              </c-col>
              <c-col [md]="6" *ngIf="isVisibleModality">
                <label cLabel>Modalidad</label>
                <app-select-parameters [parameterList]="listModality" [selectedValue]="selectedModality"
                  (onRowChange)="onSelectedModality($event)"></app-select-parameters>
              </c-col>
              <c-col [md]="6" *ngIf="isVisibleBranchOfficeStatus">
                <label cLabel>Sucursal</label>
                <app-select-parameters [parameterList]="listBranchOfficeStatus"
                  [selectedValue]="selectedBranchOfficeStatus"
                  (onRowChange)="onSelectedBranchOffice($event)"></app-select-parameters>
              </c-col>
              <c-col [md]="6" *ngIf="isVisibleCityStatus">
                <label cLabel>Ciudad</label>
                <app-select-parameters [parameterList]="listCityStatus" [selectedValue]="selectedCityStatus"
                  (onRowChange)="onSelectedCity($event)"></app-select-parameters>
              </c-col>
              <c-col [md]="6">
                <label cLabel for="nameLabel">Observaciones</label>
                <input type="text" formControlName="observations" class="form-control" [ngClass]="{
                    'is-invalid': submitted && f['observations'].errors
                  }" autoComplete="name" cFormControl placeholder="Ingrese Observaciones" />
                <div *ngIf="submitted && f['observations'].errors" class="invalid-feedback">
                  <div *ngIf="f['observations'].errors['required']">
                    required
                  </div>
                  <div *ngIf="f['observations'].errors['minlength']">
                    name must be at least 6 characters
                  </div>
                  <div *ngIf="f['observations'].errors['maxlength']">
                    name must not exceed 50 characters
                  </div>
                </div>
              </c-col>
              <c-col [xs]="12">
                <button cButton type="submit" (click)="createOrUpdate()">
                  {{ this.actionRow === 0 ? "Registrar" : "Actualizar" }}
                </button>
              </c-col>
            </form>
          </c-tab-pane>
        </c-tab-content>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<c-alert color="info" *ngIf="!isVisible">{{ message }}</c-alert>
<app-global-alerts *ngIf="visible" [visible]="visible" [message]="message"></app-global-alerts>
